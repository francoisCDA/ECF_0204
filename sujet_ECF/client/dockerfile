FROM node:14-alpine AS build

WORKDIR /app

COPY . .

RUN yarn install

ENV REACT_APP_COMMON_DATA_SERVICE_PORT 9000
ENV REACT_APP_AUTHENTICATION_SERVICE_PORT 7000
ENV REACT_APP_SEARCH_SUGGESTION_SERVICE_PORT 10000
ENV REACT_APP_COMMON_DATA_SERVICE_URL http://127.0.0.1:9000
ENV REACT_APP_AUTHENTICATION_SERVICE_URL http://127.0.0.1:7000
ENV REACT_APP_SEARCH_SUGGESTION_SERVICE_URL http://127.0.0.1:10000

ENV REACT_APP_ENVIRONMENT dev

RUN yarn build


#EXPOSE 3000

#CMD ["yarn","start"]

FROM nginx

#ENV REACT_APP_COMMON_DATA_SERVICE_PORT 9000
#ENV REACT_APP_AUTHENTICATION_SERVICE_PORT 7000
#ENV REACT_APP_SEARCH_SUGGESTION_SERVICE_PORT 10000
#ENV REACT_APP_COMMON_DATA_SERVICE_URL http://127.0.0.1:9000
#ENV REACT_APP_AUTHENTICATION_SERVICE_URL http://127.0.0.1:7000
#ENV REACT_APP_SEARCH_SUGGESTION_SERVICE_URL http://127.0.0.1:10000 

EXPOSE 80

COPY --from=build /app/build/. /usr/share/nginx/html/

CMD ["nginx","-g","daemon off;"]




